name: ğŸ”„ Sync TIL to Portfolio

on:
  workflow_run:
    workflows: ["ğŸ“ Generate Summary Pages from TIL"]
    types:
      - completed
  workflow_dispatch:

jobs:
  sync-til:
    if: github.event_name != 'workflow_run' || github.event.workflow_run.conclusion == 'success'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout TIL repo
        uses: actions/checkout@v3
        with:
          path: til-repo

      - name: Checkout Portfolio repo
        uses: actions/checkout@v3
        with:
          repository: MinHyeok-lee1/MinHyeok-lee1-portfolio
          token: ${{ secrets.PERSONAL_GITHUB_TOKEN }}
          path: portfolio-repo

      - name: Cleanup old TIL pages
        run: |
          rm -rf portfolio-repo/pages/til

      - name: Sync and convert TIL files
        run: |
          set -e
          SRC_BASE="til-repo"
          DEST_BASE="portfolio-repo/pages/til"

          # safe_tag ë³€í™˜ í•¨ìˆ˜
          to_safe_tag() {
            echo "$1" | tr '[:upper:]' '[:lower:]' | tr -c 'a-z0-9' '_' | tr -s '_' | sed 's/^_//;s/_$//'
          }

          mkdir -p "$DEST_BASE"

          find "$SRC_BASE" -type f -name "*.md" ! -path "$SRC_BASE/tags/*" | grep -vE '^til-repo/README\.md$' | while read FILE; do
            REL_PATH="${FILE#$SRC_BASE/}"
            YEAR=$(echo "$REL_PATH" | cut -d'/' -f1)
            MONTH=$(echo "$REL_PATH" | cut -d'/' -f2)
            FNAME=$(basename "$REL_PATH" .md)

            [[ "$YEAR" =~ ^[0-9]{4}$ ]] || continue
            [[ "$MONTH" =~ ^[0-9]{2}$ ]] || continue

            mkdir -p "$DEST_BASE/til-$YEAR"
            DEST_DIR="$DEST_BASE/til-$YEAR/til-$MONTH"
            mkdir -p "$DEST_DIR"
            cp "$FILE" "$DEST_DIR/$FNAME.mdx"
          done

          TAGS_SRC="$SRC_BASE/tags"
          TAGS_DIR="$DEST_BASE/tags"
          mkdir -p "$TAGS_DIR"

          shopt -s nullglob
          for FILE in "$TAGS_SRC"/*.md; do
            ORG_TAG_NAME=$(basename "$FILE" .md)
            SAFE_TAG=$(echo "$ORG_TAG_NAME" | tr '[:upper:]' '[:lower:]' | tr -c 'a-z0-9' '_' | tr -s '_' | sed 's/^_//;s/_$//')
            MDX_FILE="$TAGS_DIR/$SAFE_TAG.mdx"

            # í—¤ë” ìƒì„±
            echo "# ğŸ·ï¸ $SAFE_TAG TILëª¨ìŒ" > "$MDX_FILE"
            echo "" >> "$MDX_FILE"

            # index.mdx íŒŒì¼ì˜ ê²½ìš° ìš”ì•½ì„ ì œì™¸í•˜ê³  ìƒì„±
            if [[ "$SAFE_TAG" == "index" ]]; then
              echo "| íƒœê·¸ | ë°”ë¡œê°€ê¸° |" >> "$MDX_FILE"
              echo "|------|----------|" >> "$MDX_FILE"
            else
              echo "| ì œëª© | ë°”ë¡œê°€ê¸° |" >> "$MDX_FILE"
              echo "|------|----------|" >> "$MDX_FILE"
            fi

            # ë³¸ë¬¸ ì²˜ë¦¬
            tail -n +3 "$FILE" | while IFS='|' read -r _ TITLE DATE _ _; do
              # ì œëª©, ë‚ ì§œ ê°’ì´ ì˜¬ë°”ë¥´ê²Œ ì¶”ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸
              [[ "$TITLE" == "Title" || "$TITLE" == "---" || -z "$TITLE" ]] && continue

              # ë§í¬ íŒŒì‹±: Titleì—ì„œ ë§í¬ í…ìŠ¤íŠ¸ì™€ GitHub ë§í¬ ì¶”ì¶œ
              LINK_TEXT=$(echo "$TITLE" | grep -oP '\[[^]]+\]' | tr -d '[]')
              GITHUB_LINK=$(echo "$TITLE" | grep -oP '\(([^)]+)\)' | tr -d '()')

              # ë‚ ì§œ í¬ë§·: YYYY-MM-DDì—ì„œ Yì™€ Mì„ ì¶”ì¶œ
              SLUG=$(basename "$GITHUB_LINK" .md)
              Y=$(echo "$DATE" | cut -d'-' -f1)
              M=$(echo "$DATE" | cut -d'-' -f2)

              # Nextra ë§í¬ ìƒì„±
              NEXTRA_LINK="/til/til-$Y/til-$M/$SLUG"

              # index.mdx íŒŒì¼ì€ ìš”ì•½ì„ ì œì™¸í•˜ê³  ì¶œë ¥
              if [[ "$SAFE_TAG" == "index" ]]; then
                echo "| $LINK_TEXT | [Nextra]($NEXTRA_LINK) \| [GitHub]($GITHUB_LINK) |" >> "$MDX_FILE"
              else
                echo "| $LINK_TEXT | [Nextra]($NEXTRA_LINK) \| [GitHub]($GITHUB_LINK) |" >> "$MDX_FILE"
              fi
            done
          done
          shopt -u nullglob

      - name: Create tags/_meta.json and index.mdx
        run: |
          TAGS_DIR="portfolio-repo/pages/til/tags"
          mkdir -p "$TAGS_DIR"

          # tags/_meta.json
          TAG_META_ITEMS=()
          for FILE in "$TAGS_DIR"/*.mdx; do
            [ -f "$FILE" ] || continue
            NAME=$(basename "$FILE" .mdx)
            [ "$NAME" = "index" ] && continue
            TAG_META_ITEMS+=("\"$NAME\": \"$NAME íƒœê·¸\"")
          done

          # Ensure valid JSON format by handling commas properly
          {
            echo "{"
            echo '  "index": "ë¬¸ì„œê°œìš”"'
            for ITEM in "${TAG_META_ITEMS[@]}"; do
              echo "  ,$ITEM"
            done
            echo "}"
          } > "$TAGS_DIR/_meta.json"

          echo 'import LabelIcons from "../../../src/components/LabelIcons";' > "$TAGS_DIR/index.mdx"
          echo "" >> "$TAGS_DIR/index.mdx"
          echo "# ğŸ·ï¸ íƒœê·¸ëª¨ìŒ" >> "$TAGS_DIR/index.mdx"
          echo "ë°”ë¡œê°€ê¸°ë¥¼ ëˆ„ë¥´ì‹œë©´ í•´ë‹¹ íƒœê·¸ ê´€ë ¨ TILì •ë¦¬ë¡œ ì´ë™í•©ë‹ˆë‹¤." >> "$TAGS_DIR/index.mdx"
          echo "" >> "$mdx"
          echo "<LabelIcons />" >> "$TAGS_DIR/index.mdx"
          echo "| íƒœê·¸  | ë°”ë¡œê°€ê¸° |" >> "$TAGS_DIR/index.mdx"
          echo "|------|----------|" >> "$TAGS_DIR/index.mdx"
          for FILE in "$TAGS_DIR"/*.mdx; do
            NAME=$(basename "$FILE" .mdx)
            [ "$NAME" = "index" ] && continue
            echo "| $NAME | [Nextra](/til/tags/$NAME) \| [GitHub](https://github.com/MinHyeok-lee1/TIL/blob/main/tags/$NAME.md) |" >> "$TAGS_DIR/index.mdx"
          done

      - name: Create summaries and generate summary pages
        run: |
          SRC_BASE="til-repo"
          DEST_BASE="portfolio-repo/pages/til/summaries"

          # summaries ë””ë ‰í„°ë¦¬ê°€ ì—†ë‹¤ë©´ ìƒì„±
          mkdir -p "$DEST_BASE"

          # _meta.json íŒŒì¼ ìƒì„±
          {
            echo "{"
            echo '  "2025-summaries": "2025ë…„ TIL ìš”ì•½"'  # 2025ë…„ TIL ìš”ì•½ ì¶”ê°€
            echo "}"
          } > "$DEST_BASE/_meta.json"

          # ì„ì‹œ ë¦¬ìŠ¤íŠ¸ ìƒì„±
          LIST=$(mktemp)

          # TIL íŒŒì¼ì„ ì²˜ë¦¬í•˜ì—¬ ìš”ì•½ í˜ì´ì§€ ìƒì„±
          find "$SRC_BASE" -type f -name "*.md" ! -path "$SRC_BASE/tags/*" | grep -vE '^til-repo/README\.md$' | while read FILE; do
            REL_PATH="${FILE#$SRC_BASE/}"
            YEAR=$(echo "$REL_PATH" | cut -d'/' -f1)
            MONTH=$(echo "$REL_PATH" | cut -d'/' -f2)
            FNAME=$(basename "$REL_PATH" .md)

            # YAML ë©”íƒ€ë°ì´í„°ì—ì„œ ìš”ì•½ ì¶”ì¶œ
            content=$(cat "$FILE")
            summary=$(echo "$content" | sed -n '/^summary:/p' | sed 's/summary: //')

            # Nextra ë° GitHub ë§í¬ ìƒì„± (ìƒëŒ€ ê²½ë¡œ)
            NEXTRA_LINK="/til/til-$YEAR/til-$MONTH/$FNAME"
            GITHUB_LINK="https://github.com/MinHyeok-lee1/TIL/blob/main/$REL_PATH"

            # ìš”ì•½ì´ ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´ ë¦¬ìŠ¤íŠ¸ì— ì €ì¥
            if [ -n "$summary" ]; then
              echo "$summary|$NEXTRA_LINK|$GITHUB_LINK|$MONTH" >> "$LIST"
            fi
          done

          # ìƒì„±ëœ ìš”ì•½ íŒŒì¼ ì €ì¥ (íŒŒì¼ëª…: 2025-summaries.mdx)
          SUMMARY_FILE="$DEST_BASE/2025-summaries.mdx"
          mkdir -p "$(dirname "$SUMMARY_FILE")"

          # LabelIcons ì»´í¬ë„ŒíŠ¸ ì„í¬íŠ¸ê°€ ì—†ìœ¼ë©´ ì¶”ê°€
          if ! grep -q 'import LabelIcons' "$SUMMARY_FILE"; then
            echo 'import LabelIcons from "../../../src/components/LabelIcons";' > "$SUMMARY_FILE"
            echo "" >> "$SUMMARY_FILE"
            echo "# 2025 Summaries" >> "$SUMMARY_FILE"
            echo "2025ë…„ì˜ ì›”ë³„ ìš”ì•½ì…ë‹ˆë‹¤.<br />" >> "$SUMMARY_FILE"
            echo "ë°”ë¡œê°€ê¸°ë¥¼ ëˆ„ë¥´ì‹œë©´ í•´ë‹¹ TILë¡œ ì´ë™í•©ë‹ˆë‹¤." >> "$SUMMARY_FILE"
            echo "" >> "$mdx"
            echo "<LabelIcons />" >> "$SUMMARY_FILE"
          fi

          # ì›”ë³„ë¡œ í…Œì´ë¸” ì¶”ê°€ (1ì›”ë¶€í„° 12ì›”ê¹Œì§€)
          sort "$LIST" | uniq | while IFS="|" read summary NEXTRA_LINK GITHUB_LINK MONTH; do
            # í•´ë‹¹ ì›”ì˜ í…Œì´ë¸”ì´ ì—†ë‹¤ë©´ ì¶”ê°€
            if ! grep -q "## $MONTHì›”" "$SUMMARY_FILE"; then
              echo "" >> "$SUMMARY_FILE"
              echo "## $MONTHì›”" >> "$SUMMARY_FILE"
              echo "" >> "$SUMMARY_FILE"
              echo "| ìš”ì•½ | ë°”ë¡œê°€ê¸° |" >> "$SUMMARY_FILE"
              echo "|---------|------------------|" >> "$SUMMARY_FILE"
            fi
            # í…Œì´ë¸” í•­ëª© ì¶”ê°€
            echo "| $summary | [Nextra]($NEXTRA_LINK) \| [GitHub]($GITHUB_LINK) |" >> "$SUMMARY_FILE"
          done

          # ì„ì‹œ ë¦¬ìŠ¤íŠ¸ íŒŒì¼ ì‚­ì œ
          rm "$LIST"

          shopt -u nullglob

      - name: Create all _meta.json and index.mdx files
        run: |
          BASE="portfolio-repo/pages/til"
          YEARS=()
          for YEAR_DIR in "$BASE"/til-*; do
            [ -d "$YEAR_DIR" ] || continue
            YEARS+=("$(basename "$YEAR_DIR" | cut -d'-' -f2)")
          done
          {
            echo "{"
            echo '  "index": "ë¬¸ì„œê°œìš”"'
            echo '  ,"tags": "íƒœê·¸ëª¨ìŒ"'
            for YEAR in "${YEARS[@]}"; do
              echo '  ,"til-'"$YEAR"'": "'"$YEAR"'ë…„ TIL"'
            done
            echo '  ,"summaries": "ìš”ì•½ëª¨ìŒ"'
            echo "}"
          } > "$BASE/_meta.json"

          # index.mdx íŒŒì¼ ì—…ë°ì´íŠ¸
          echo "# ğŸ““ Today I Learned (TIL)" > "$BASE/index.mdx"
          echo "" >> "$BASE/index.mdx"
          echo "> ê¾¸ì¤€í•œ ê¸°ë¡ì€ ìµœê³ ì˜ ì„±ì¥ìœ¼ë¡œ ì´ì–´ì§„ë‹¤." >> "$BASE/index.mdx"
          echo "" >> "$BASE/index.mdx"
          echo "- ì•„ë˜ëŠ” TILë¬¸ì„œì— ëŒ€í•œ íƒœê·¸, ì—°ë„ë³„ ì •ë¦¬, ìš”ì•½ëª¨ìŒ ë“±ì´ ì •ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤." >> "$BASE/index.mdx"
          echo "- ê° ê¸€ì˜ ë§í¬ë“¤ì€ Nextra(ë³¸ ì›¹ì‚¬ì´íŠ¸), Github(ì›ë³¸) ë¬¸ì„œë¡œ ì´ë™í•©ë‹ˆë‹¤." >> "$BASE/index.mdx"
          echo "" >> "$BASE/index.mdx"
          echo "---" >> "$BASE/index.mdx"

          echo "## ğŸ·ï¸ TIL íƒœê·¸ëª¨ìŒ" >> "$BASE/index.mdx"
          echo "- [TIL íƒœê·¸ëª¨ìŒ](/til/tags)" >> "$BASE/index.mdx"
          echo ": TIL ë¬¸ì„œì— ëŒ€í•œ íƒœê·¸ë“¤ì˜ ë§í¬ê°€ ì •ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤." >> "$BASE/index.mdx"

          echo "" >> "$BASE/index.mdx"
          echo "---" >> "$BASE/index.mdx"

          echo "## ğŸ“… ì—°ë„ë³„ TILëª¨ìŒ" >> "$BASE/index.mdx"
          # ì—°ë„ë³„ë¡œ TIL í˜ì´ì§€ ì¶”ê°€
          for YEAR in "${YEARS[@]}"; do
            echo "- [${YEAR}ë…„ TIL](/til/til-$YEAR)" >> "$BASE/index.mdx"
            echo ": ${YEAR}ë…„ ì›”ë³„ë¡œ ê¸€ì„ ì •ë¦¬í•œ ë§í¬ê°€ ì •ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤." >> "$BASE/index.mdx"
            echo "" >> "$BASE/index.mdx"
          done

          echo "" >> "$BASE/index.mdx"
          echo "---" >> "$BASE/index.mdx"

          # 2025ë…„ TIL ìš”ì•½ ì¶”ê°€
          echo "## ğŸ“‘ TIL ìš”ì•½ëª¨ìŒ" >> "$BASE/index.mdx"
          for YEAR in "${YEARS[@]}"; do
            echo "- [${YEAR}ë…„ TILìš”ì•½](/til/summaries/${YEAR}-summaries)" >> "$BASE/index.mdx"
            echo ": ${YEAR}ë…„ ì›”ë³„ë¡œ ìš”ì•½ê³¼ ë°”ë¡œê°€ê¸° ë§í¬ê°€ ì •ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤." >> "$BASE/index.mdx"
            echo "" >> "$BASE/index.mdx"
          done

          for YEAR in "${YEARS[@]}"; do
            YEAR_DIR="$BASE/til-$YEAR"
            MONTHS=()
            for MONTH_DIR in "$YEAR_DIR"/til-*; do
              [ -d "$MONTH_DIR" ] || continue
              MONTHS+=("til-$(basename "$MONTH_DIR" | cut -d'-' -f2)")
            done
            {
              echo "{"
              echo '  "index": "ë¬¸ì„œê°œìš”"'
              for MONTH in "${MONTHS[@]}"; do
                M=$(echo "$MONTH" | cut -d'-' -f2)
                echo '  ,"'"$MONTH"'": "'"$M"'ì›” TIL"'
              done
              echo "}"
            } > "$YEAR_DIR/_meta.json"

            echo 'import LabelIcons from "../../../src/components/LabelIcons";' > "$YEAR_DIR/index.mdx"
            echo "" >> "$YEAR_DIR/index.mdx"
            echo "# ë¬¸ì„œê°œìš”" >> "$YEAR_DIR/index.mdx"
            echo "${YEAR}ë…„ TIL ê¸°ë¡ì…ë‹ˆë‹¤.<br />" >> "$YEAR_DIR/index.mdx"
            echo "ë°”ë¡œê°€ê¸°ë¥¼ ëˆ„ë¥´ì‹œë©´ ì›” ê´€ë ¨ TIL ì •ë¦¬ë¡œ ì´ë™í•©ë‹ˆë‹¤." >> "$YEAR_DIR/index.mdx"
            echo "" >> "$mdx"
            echo "<LabelIcons />" >> "$YEAR_DIR/index.mdx"
            echo "" >> "$YEAR_DIR/index.mdx"
            echo "| ì›” | ë°”ë¡œê°€ê¸° |" >> "$YEAR_DIR/index.mdx"
            echo "|----|----------|" >> "$YEAR_DIR/index.mdx"
            for MONTH_DIR in "$YEAR_DIR"/til-*; do
              [ -d "$MONTH_DIR" ] || continue
              MONTH=$(basename "$MONTH_DIR" | cut -d'-' -f2)
              echo "| ${MONTH}ì›” | [Nextra](/til/til-$YEAR/til-$MONTH) \| [GitHub](https://github.com/MinHyeok-lee1/TIL/blob/main/$YEAR/$MONTH) |" >> "$YEAR_DIR/index.mdx"
            done

            for MONTH_DIR in "$YEAR_DIR"/til-*; do
              [ -d "$MONTH_DIR" ] || continue
              MONTH_META_ITEMS=()
              FILES=()
              for FILE in "$MONTH_DIR"/*.mdx; do
                [ -f "$FILE" ] || continue
                FNAME=$(basename "$FILE" .mdx)
                [ "$FNAME" = "index" ] && continue
                DAY=$(echo "$FNAME" | cut -d'-' -f1)
                TITLE_CLEAN=$(echo "$FNAME" | cut -d'-' -f2- | sed 's/-/ /g')
                MONTH_META_ITEMS+=("\"$FNAME\": \"${DAY}-${TITLE_CLEAN}\"")
                FILES+=("$FNAME")
              done
              {
                echo "{"
                echo '  "index": "ë¬¸ì„œê°œìš”"'
                for ITEM in "${MONTH_META_ITEMS[@]}"; do
                  echo "  ,$ITEM"
                done
                echo "}"
              } > "$MONTH_DIR/_meta.json"

              MONTH_NUM=$(basename "$MONTH_DIR" | cut -d'-' -f2)
              echo 'import LabelIcons from "../../../../src/components/LabelIcons";' > "$MONTH_DIR/index.mdx"
              echo "" >> "$MONTH_DIR/index.mdx"
              echo "# ë¬¸ì„œê°œìš”" >> "$MONTH_DIR/index.mdx"
              echo "${YEAR}ë…„ ${MONTH_NUM}ì›” TIL ê¸°ë¡ì…ë‹ˆë‹¤.<br />" >> "$MONTH_DIR/index.mdx"
              echo "ë°”ë¡œê°€ê¸°ë¥¼ ëˆ„ë¥´ì‹œë©´ í•´ë‹¹ TILë¡œ ì´ë™í•©ë‹ˆë‹¤." >> "$MONTH_DIR/index.mdx"
              echo "" >> "$mdx"
              echo "<LabelIcons />" >> "$MONTH_DIR/index.mdx"
              echo "" >> "$MONTH_DIR/index.mdx"
              echo "| ì œëª© | ë°”ë¡œê°€ê¸° |" >> "$MONTH_DIR/index.mdx"
              echo "|------|----------|" >> "$MONTH_DIR/index.mdx"
              for FNAME in "${FILES[@]}"; do
                DAY=$(echo "$FNAME" | cut -d'-' -f1)
                TITLE_CLEAN=$(echo "$FNAME" | cut -d'-' -f2- | sed 's/-/ /g')
                echo "| ${DAY}-${TITLE_CLEAN} | [Nextra](/til/til-$YEAR/til-$MONTH_NUM/$FNAME) \| [GitHub](https://github.com/MinHyeok-lee1/TIL/blob/main/$YEAR/$MONTH_NUM/$FNAME.md) |" >> "$MONTH_DIR/index.mdx"
              done
            done
          done

      - name: Create tags tables (Nextra/GitHub/Summary)
        run: |
          set -e
          BASE="portfolio-repo/pages/til"
          TAGS_DIR="$BASE/tags"
          mkdir -p "$TAGS_DIR"

          to_safe_tag() {
            echo "$1" | tr '[:upper:]' '[:lower:]' | tr -c 'a-z0-9' '_' | tr -s '_' | sed 's/^_//;s/_$//'
          }

          files=$(find "$BASE"/til-*/*/*.mdx -type f)
          if [ -z "$files" ]; then
            echo "No mdx files found for tags. Skipping tag table generation."
            exit 0
          fi

          for FILE in $files; do
            yaml=$(awk '/^---/ {i++} i==1; i==2 {exit}' "$FILE" | sed '1d;$d')
            tag_line=$(echo "$yaml" | grep "^tags:") || true
            [ -z "$tag_line" ] && continue
            tags=$(echo "$tag_line" | sed 's/tags:[ ]*\[\(.*\)\]/\1/' | tr -d '"'\'' ')
            IFS=',' read -ra tagarr <<< "$tags"

            summary=$(echo "$yaml" | grep "^summary:" | sed 's/summary:[ ]*//') || true
            [ -z "$summary" ] && summary="No summary available"

            REL_PATH="${FILE#$BASE/}"
            YEAR=$(echo "$REL_PATH" | cut -d'/' -f1 | cut -d'-' -f2)
            MONTH=$(echo "$REL_PATH" | cut -d'/' -f2 | cut -d'-' -f2)
            FNAME=$(basename "$REL_PATH" .mdx)
            NEXTRA_LINK="/til/til-$YEAR/til-$MONTH/$FNAME"
            GITHUB_LINK="https://github.com/MinHyeok-lee1/TIL/blob/main/$YEAR/$MONTH/$FNAME.md"

            for tag in "${tagarr[@]}"; do
              safe_tag=$(to_safe_tag "$tag")
              [ -z "$safe_tag" ] && continue
              echo "$FNAME|$YEAR|$MONTH|$NEXTRA_LINK|$GITHUB_LINK|$summary" >> "$TAGS_DIR/$safe_tag.list"
            done
          done

          shopt -s nullglob
          for LIST in "$TAGS_DIR"/*.list; do
            safe_tag=$(basename "$LIST" .list)
            mdx="$TAGS_DIR/$safe_tag.mdx"
            safe_tag_path="../../../src/components/LabelIcons"
            
            echo "import LabelIcons from \"$safe_tag_path\";" > "$mdx"
            echo "" >> "$mdx"
            echo "# ğŸ·ï¸ $safe_tag TILëª¨ìŒ" >> "$mdx"
            echo "" >> "$mdx"
            echo "ë°”ë¡œê°€ê¸°ë¥¼ ëˆ„ë¥´ì‹œë©´ í•´ë‹¹ TILë¡œ ì´ë™í•©ë‹ˆë‹¤." >> "$mdx"
            echo "" >> "$mdx"
            echo "<LabelIcons />" >> "$mdx"
            echo "" >> "$mdx"
            
            # ìš”ì•½ì„ ì œì™¸í•˜ê³  'ì œëª©'ê³¼ 'ë°”ë¡œê°€ê¸°'ë§Œ ì¶œë ¥
            echo "| ì œëª© | ë°”ë¡œê°€ê¸° |" >> "$mdx"
            echo "|------|----------|" >> "$mdx"
            
            sort "$LIST" | uniq | while IFS="|" read FNAME YEAR MONTH NEXTRA_LINK GITHUB_LINK _; do
                TITLE=$(echo "${FNAME//-/ }" | sed 's/^[0-9]* //')  # ìˆ«ì ì œê±°
                echo "| $TITLE | [Nextra]($NEXTRA_LINK) \| [GitHub]($GITHUB_LINK) |" >> "$mdx"
            done
            rm "$LIST"
          done
          shopt -u nullglob

      - name: Commit and Push
        run: |
          cd portfolio-repo
          git config user.name "MinHyeok-lee1"
          git config user.email "minhyeok.lee1@gmail.com"
          git add .
          if git diff --cached --quiet; then
            echo "âœ… No changes to commit"
            exit 0
          fi
          git commit -m "ğŸ“ Sync TIL to portfolio: $(date +'%Y-%m-%d')"
          git push
